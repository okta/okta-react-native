{"version":3,"file":"browser.js","names":["getStorage","storageUtil","Object","assign","browserStorage","inMemoryStore","STORAGE_MANAGER_OPTIONS","token","storageTypes","cache","transaction","getCookieSettings","args","isHTTPS","cookieSettings","cookies","secure","sameSite","warn"],"sources":["../../../../lib/storage/options/browser.ts"],"sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n/* eslint-disable complexity */\nimport { StorageManagerOptions, StorageUtil, OktaAuthStorageOptions } from '../types';\nimport { warn } from '../../util';\n\nimport { default as browserStorage } from '../../browser/browserStorage';\n\nexport function getStorage(): StorageUtil {\n  const storageUtil = Object.assign({}, browserStorage, {\n    inMemoryStore: {} // create unique storage for this instance\n  });\n  return storageUtil;\n}\n\nexport const STORAGE_MANAGER_OPTIONS: StorageManagerOptions = {\n  token: {\n    storageTypes: [\n      'localStorage',\n      'sessionStorage',\n      'cookie'\n    ]\n  },\n  cache: {\n    storageTypes: [\n      'localStorage',\n      'sessionStorage',\n      'cookie'\n    ]\n  },\n  transaction: {\n    storageTypes: [\n      'sessionStorage',\n      'localStorage',\n      'cookie'\n    ]\n  },\n  'shared-transaction': {\n    storageTypes: [\n      'localStorage'\n    ]\n  },\n  'original-uri': {\n    storageTypes: [\n      'localStorage'\n    ]\n  }\n};\n\nexport function getCookieSettings(args: OktaAuthStorageOptions = {}, isHTTPS: boolean) {\n  // Secure cookies will be automatically used on a HTTPS connection\n  // Non-secure cookies will be automatically used on a HTTP connection\n  // secure option can override the automatic behavior\n  var cookieSettings = args.cookies || {};\n  if (typeof cookieSettings.secure === 'undefined') {\n    cookieSettings.secure = isHTTPS;\n  }\n  if (typeof cookieSettings.sameSite === 'undefined') {\n    cookieSettings.sameSite = cookieSettings.secure ? 'none' : 'lax';\n  }\n\n  // If secure=true, but the connection is not HTTPS, set secure=false.\n  if (cookieSettings.secure && !isHTTPS) {\n    // eslint-disable-next-line no-console\n    warn(\n      'The current page is not being served with the HTTPS protocol.\\n' +\n      'For security reasons, we strongly recommend using HTTPS.\\n' +\n      'If you cannot use HTTPS, set \"cookies.secure\" option to false.'\n    );\n    cookieSettings.secure = false;\n  }\n\n  // Chrome >= 80 will block cookies with SameSite=None unless they are also Secure\n  // If sameSite=none, but the connection is not HTTPS, set sameSite=lax.\n  if (cookieSettings.sameSite === 'none' && !cookieSettings.secure) {\n    cookieSettings.sameSite = 'lax';\n  }\n\n  return cookieSettings;\n}\n"],"mappings":";;;;;;AAcA;AAEA;AAhBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAMO,SAASA,UAAU,GAAgB;EACxC,MAAMC,WAAW,GAAGC,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAEC,uBAAc,EAAE;IACpDC,aAAa,EAAE,CAAC,CAAC,CAAC;EACpB,CAAC,CAAC;;EACF,OAAOJ,WAAW;AACpB;AAEO,MAAMK,uBAA8C,GAAG;EAC5DC,KAAK,EAAE;IACLC,YAAY,EAAE,CACZ,cAAc,EACd,gBAAgB,EAChB,QAAQ;EAEZ,CAAC;EACDC,KAAK,EAAE;IACLD,YAAY,EAAE,CACZ,cAAc,EACd,gBAAgB,EAChB,QAAQ;EAEZ,CAAC;EACDE,WAAW,EAAE;IACXF,YAAY,EAAE,CACZ,gBAAgB,EAChB,cAAc,EACd,QAAQ;EAEZ,CAAC;EACD,oBAAoB,EAAE;IACpBA,YAAY,EAAE,CACZ,cAAc;EAElB,CAAC;EACD,cAAc,EAAE;IACdA,YAAY,EAAE,CACZ,cAAc;EAElB;AACF,CAAC;AAAC;AAEK,SAASG,iBAAiB,CAACC,IAA4B,GAAG,CAAC,CAAC,EAAEC,OAAgB,EAAE;EACrF;EACA;EACA;EACA,IAAIC,cAAc,GAAGF,IAAI,CAACG,OAAO,IAAI,CAAC,CAAC;EACvC,IAAI,OAAOD,cAAc,CAACE,MAAM,KAAK,WAAW,EAAE;IAChDF,cAAc,CAACE,MAAM,GAAGH,OAAO;EACjC;EACA,IAAI,OAAOC,cAAc,CAACG,QAAQ,KAAK,WAAW,EAAE;IAClDH,cAAc,CAACG,QAAQ,GAAGH,cAAc,CAACE,MAAM,GAAG,MAAM,GAAG,KAAK;EAClE;;EAEA;EACA,IAAIF,cAAc,CAACE,MAAM,IAAI,CAACH,OAAO,EAAE;IACrC;IACA,IAAAK,UAAI,EACF,iEAAiE,GACjE,4DAA4D,GAC5D,gEAAgE,CACjE;IACDJ,cAAc,CAACE,MAAM,GAAG,KAAK;EAC/B;;EAEA;EACA;EACA,IAAIF,cAAc,CAACG,QAAQ,KAAK,MAAM,IAAI,CAACH,cAAc,CAACE,MAAM,EAAE;IAChEF,cAAc,CAACG,QAAQ,GAAG,KAAK;EACjC;EAEA,OAAOH,cAAc;AACvB"}