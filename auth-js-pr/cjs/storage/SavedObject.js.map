{"version":3,"file":"SavedObject.js","names":["SavedObject","constructor","storage","storageName","AuthSdkError","length","storageProvider","getItem","key","getStorage","setItem","value","updateStorage","removeItem","clearStorage","storageString","JSON","parse","e","setStorage","obj","stringify"],"sources":["../../../lib/storage/SavedObject.ts"],"sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n *\n */\n\nimport AuthSdkError from '../errors/AuthSdkError';\nimport { StorageProvider, SimpleStorage } from './types';\n\n// formerly known as \"storageBuilder\". Represents an object saved under a key/name.\nexport class SavedObject implements StorageProvider {\n  storageProvider: SimpleStorage;\n  storageName: string;\n\n  constructor(storage: SimpleStorage, storageName: string) {\n    if (!storage) {\n      throw new AuthSdkError('\"storage\" is required');\n    }\n\n    if (typeof storageName !== 'string' || !storageName.length) {\n      throw new AuthSdkError('\"storageName\" is required');\n    }\n\n    this.storageName = storageName;\n    this.storageProvider = storage;\n  }\n\n  //\n  // SimpleStorage interface\n  //\n\n  getItem(key: string) {\n    return this.getStorage()[key];\n  }\n\n  setItem(key: string, value: any) {\n    return this.updateStorage(key, value);\n  }\n\n  removeItem(key: string) {\n    return this.clearStorage(key);\n  }\n\n  //\n  // StorageProvider interface\n  //\n\n  getStorage() {\n    var storageString = this.storageProvider.getItem(this.storageName);\n    storageString = storageString || '{}';\n    try {\n      return JSON.parse(storageString);\n    } catch(e) {\n      throw new AuthSdkError('Unable to parse storage string: ' + this.storageName);\n    }\n  }\n\n  setStorage(obj?: any) {\n    try {\n      var storageString = obj ? JSON.stringify(obj) : '{}';\n      this.storageProvider.setItem(this.storageName, storageString);\n    } catch(e) {\n      throw new AuthSdkError('Unable to set storage: ' + this.storageName);\n    }\n  }\n\n  clearStorage(key?: string) {\n    if (!key) {\n      // clear all\n      if (this.storageProvider.removeItem) {\n        this.storageProvider.removeItem(this.storageName);\n      } else {\n        this.setStorage();\n      }\n      return;\n    }\n\n    var obj = this.getStorage();\n    delete obj[key];\n    this.setStorage(obj);\n  }\n\n  updateStorage(key, value) {\n    var obj = this.getStorage();\n    obj[key] = value;\n    this.setStorage(obj);\n  }\n}\n"],"mappings":";;;;AAaA;AAbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAKA;AACO,MAAMA,WAAW,CAA4B;EAIlDC,WAAW,CAACC,OAAsB,EAAEC,WAAmB,EAAE;IACvD,IAAI,CAACD,OAAO,EAAE;MACZ,MAAM,IAAIE,qBAAY,CAAC,uBAAuB,CAAC;IACjD;IAEA,IAAI,OAAOD,WAAW,KAAK,QAAQ,IAAI,CAACA,WAAW,CAACE,MAAM,EAAE;MAC1D,MAAM,IAAID,qBAAY,CAAC,2BAA2B,CAAC;IACrD;IAEA,IAAI,CAACD,WAAW,GAAGA,WAAW;IAC9B,IAAI,CAACG,eAAe,GAAGJ,OAAO;EAChC;;EAEA;EACA;EACA;;EAEAK,OAAO,CAACC,GAAW,EAAE;IACnB,OAAO,IAAI,CAACC,UAAU,EAAE,CAACD,GAAG,CAAC;EAC/B;EAEAE,OAAO,CAACF,GAAW,EAAEG,KAAU,EAAE;IAC/B,OAAO,IAAI,CAACC,aAAa,CAACJ,GAAG,EAAEG,KAAK,CAAC;EACvC;EAEAE,UAAU,CAACL,GAAW,EAAE;IACtB,OAAO,IAAI,CAACM,YAAY,CAACN,GAAG,CAAC;EAC/B;;EAEA;EACA;EACA;;EAEAC,UAAU,GAAG;IACX,IAAIM,aAAa,GAAG,IAAI,CAACT,eAAe,CAACC,OAAO,CAAC,IAAI,CAACJ,WAAW,CAAC;IAClEY,aAAa,GAAGA,aAAa,IAAI,IAAI;IACrC,IAAI;MACF,OAAOC,IAAI,CAACC,KAAK,CAACF,aAAa,CAAC;IAClC,CAAC,CAAC,OAAMG,CAAC,EAAE;MACT,MAAM,IAAId,qBAAY,CAAC,kCAAkC,GAAG,IAAI,CAACD,WAAW,CAAC;IAC/E;EACF;EAEAgB,UAAU,CAACC,GAAS,EAAE;IACpB,IAAI;MACF,IAAIL,aAAa,GAAGK,GAAG,GAAGJ,IAAI,CAACK,SAAS,CAACD,GAAG,CAAC,GAAG,IAAI;MACpD,IAAI,CAACd,eAAe,CAACI,OAAO,CAAC,IAAI,CAACP,WAAW,EAAEY,aAAa,CAAC;IAC/D,CAAC,CAAC,OAAMG,CAAC,EAAE;MACT,MAAM,IAAId,qBAAY,CAAC,yBAAyB,GAAG,IAAI,CAACD,WAAW,CAAC;IACtE;EACF;EAEAW,YAAY,CAACN,GAAY,EAAE;IACzB,IAAI,CAACA,GAAG,EAAE;MACR;MACA,IAAI,IAAI,CAACF,eAAe,CAACO,UAAU,EAAE;QACnC,IAAI,CAACP,eAAe,CAACO,UAAU,CAAC,IAAI,CAACV,WAAW,CAAC;MACnD,CAAC,MAAM;QACL,IAAI,CAACgB,UAAU,EAAE;MACnB;MACA;IACF;IAEA,IAAIC,GAAG,GAAG,IAAI,CAACX,UAAU,EAAE;IAC3B,OAAOW,GAAG,CAACZ,GAAG,CAAC;IACf,IAAI,CAACW,UAAU,CAACC,GAAG,CAAC;EACtB;EAEAR,aAAa,CAACJ,GAAG,EAAEG,KAAK,EAAE;IACxB,IAAIS,GAAG,GAAG,IAAI,CAACX,UAAU,EAAE;IAC3BW,GAAG,CAACZ,GAAG,CAAC,GAAGG,KAAK;IAChB,IAAI,CAACQ,UAAU,CAACC,GAAG,CAAC;EACtB;AACF;AAAC"}