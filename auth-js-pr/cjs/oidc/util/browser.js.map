{"version":3,"file":"browser.js","names":["addListener","eventTarget","name","fn","addEventListener","attachEvent","removeListener","removeEventListener","detachEvent","loadFrame","src","iframe","document","createElement","style","display","body","appendChild","loadPopup","options","title","popupTitle","appearance","window","open","addPostMessageListener","sdk","timeout","state","responseHandler","timeoutId","msgReceivedOrTimeout","Promise","resolve","reject","e","data","origin","getIssuerOrigin","AuthSdkError","setTimeout","finally","clearTimeout"],"sources":["../../../../lib/oidc/util/browser.ts"],"sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n *\n */\n/* global window, document */\n/* eslint-disable complexity, max-statements */\nimport { AuthSdkError } from '../../errors';\nimport { OktaAuthOAuthInterface } from '../types';\n\nexport function addListener(eventTarget, name, fn) {\n  if (eventTarget.addEventListener) {\n    eventTarget.addEventListener(name, fn);\n  } else {\n    eventTarget.attachEvent('on' + name, fn);\n  }\n}\n\nexport function removeListener(eventTarget, name, fn) {\n  if (eventTarget.removeEventListener) {\n    eventTarget.removeEventListener(name, fn);\n  } else {\n    eventTarget.detachEvent('on' + name, fn);\n  }\n}\n\nexport function loadFrame(src) {\n  var iframe = document.createElement('iframe');\n  iframe.style.display = 'none';\n  iframe.src = src;\n\n  return document.body.appendChild(iframe);\n}\n\nexport function loadPopup(src, options) {\n  var title = options.popupTitle || 'External Identity Provider User Authentication';\n  var appearance = 'toolbar=no, scrollbars=yes, resizable=yes, ' +\n    'top=100, left=500, width=600, height=600';\n  return window.open(src, title, appearance);\n}\n\nexport function addPostMessageListener(sdk: OktaAuthOAuthInterface, timeout, state) {\n  var responseHandler;\n  var timeoutId;\n  var msgReceivedOrTimeout = new Promise(function (resolve, reject) {\n\n    responseHandler = function responseHandler(e) {\n      if (!e.data || e.data.state !== state) {\n        // A message not meant for us\n        return;\n      }\n\n      // Configuration mismatch between saved token and current app instance\n      // This may happen if apps with different issuers are running on the same host url\n      // If they share the same storage key, they may read and write tokens in the same location.\n      // Common when developing against http://localhost\n      if (e.origin !== sdk.getIssuerOrigin()) {\n        return reject(new AuthSdkError('The request does not match client configuration'));\n      }\n      resolve(e.data);\n    };\n\n    addListener(window, 'message', responseHandler);\n\n    timeoutId = setTimeout(function () {\n      reject(new AuthSdkError('OAuth flow timed out'));\n    }, timeout || 120000);\n  });\n\n  return msgReceivedOrTimeout\n    .finally(function () {\n      clearTimeout(timeoutId);\n      removeListener(window, 'message', responseHandler);\n    });\n}\n"],"mappings":";;;;;;;AAcA;AAdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAIO,SAASA,WAAW,CAACC,WAAW,EAAEC,IAAI,EAAEC,EAAE,EAAE;EACjD,IAAIF,WAAW,CAACG,gBAAgB,EAAE;IAChCH,WAAW,CAACG,gBAAgB,CAACF,IAAI,EAAEC,EAAE,CAAC;EACxC,CAAC,MAAM;IACLF,WAAW,CAACI,WAAW,CAAC,IAAI,GAAGH,IAAI,EAAEC,EAAE,CAAC;EAC1C;AACF;AAEO,SAASG,cAAc,CAACL,WAAW,EAAEC,IAAI,EAAEC,EAAE,EAAE;EACpD,IAAIF,WAAW,CAACM,mBAAmB,EAAE;IACnCN,WAAW,CAACM,mBAAmB,CAACL,IAAI,EAAEC,EAAE,CAAC;EAC3C,CAAC,MAAM;IACLF,WAAW,CAACO,WAAW,CAAC,IAAI,GAAGN,IAAI,EAAEC,EAAE,CAAC;EAC1C;AACF;AAEO,SAASM,SAAS,CAACC,GAAG,EAAE;EAC7B,IAAIC,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;EAC7CF,MAAM,CAACG,KAAK,CAACC,OAAO,GAAG,MAAM;EAC7BJ,MAAM,CAACD,GAAG,GAAGA,GAAG;EAEhB,OAAOE,QAAQ,CAACI,IAAI,CAACC,WAAW,CAACN,MAAM,CAAC;AAC1C;AAEO,SAASO,SAAS,CAACR,GAAG,EAAES,OAAO,EAAE;EACtC,IAAIC,KAAK,GAAGD,OAAO,CAACE,UAAU,IAAI,gDAAgD;EAClF,IAAIC,UAAU,GAAG,6CAA6C,GAC5D,0CAA0C;EAC5C,OAAOC,MAAM,CAACC,IAAI,CAACd,GAAG,EAAEU,KAAK,EAAEE,UAAU,CAAC;AAC5C;AAEO,SAASG,sBAAsB,CAACC,GAA2B,EAAEC,OAAO,EAAEC,KAAK,EAAE;EAClF,IAAIC,eAAe;EACnB,IAAIC,SAAS;EACb,IAAIC,oBAAoB,GAAG,IAAIC,OAAO,CAAC,UAAUC,OAAO,EAAEC,MAAM,EAAE;IAEhEL,eAAe,GAAG,SAASA,eAAe,CAACM,CAAC,EAAE;MAC5C,IAAI,CAACA,CAAC,CAACC,IAAI,IAAID,CAAC,CAACC,IAAI,CAACR,KAAK,KAAKA,KAAK,EAAE;QACrC;QACA;MACF;;MAEA;MACA;MACA;MACA;MACA,IAAIO,CAAC,CAACE,MAAM,KAAKX,GAAG,CAACY,eAAe,EAAE,EAAE;QACtC,OAAOJ,MAAM,CAAC,IAAIK,oBAAY,CAAC,iDAAiD,CAAC,CAAC;MACpF;MACAN,OAAO,CAACE,CAAC,CAACC,IAAI,CAAC;IACjB,CAAC;IAEDpC,WAAW,CAACuB,MAAM,EAAE,SAAS,EAAEM,eAAe,CAAC;IAE/CC,SAAS,GAAGU,UAAU,CAAC,YAAY;MACjCN,MAAM,CAAC,IAAIK,oBAAY,CAAC,sBAAsB,CAAC,CAAC;IAClD,CAAC,EAAEZ,OAAO,IAAI,MAAM,CAAC;EACvB,CAAC,CAAC;EAEF,OAAOI,oBAAoB,CACxBU,OAAO,CAAC,YAAY;IACnBC,YAAY,CAACZ,SAAS,CAAC;IACvBxB,cAAc,CAACiB,MAAM,EAAE,SAAS,EAAEM,eAAe,CAAC;EACpD,CAAC,CAAC;AACN"}