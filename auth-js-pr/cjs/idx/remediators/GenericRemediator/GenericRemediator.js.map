{"version":3,"file":"GenericRemediator.js","names":["GenericRemediator","Remediator","canRemediate","remediation","action","name","endsWith","options","step","getData","data","getInputs","reduce","acc","values","getNextStep","authClient","_context","getName","inputs","href","method","rel","accepts","produces","value","rest","length","params","idx","proceed","filter","map","unwrapFormValue","input","type"],"sources":["../../../../../lib/idx/remediators/GenericRemediator/GenericRemediator.ts"],"sourcesContent":["import { OktaAuthIdxInterface, IdxContext, NextStep, Input } from '../../types';\nimport { Remediator } from '../Base/Remediator';\nimport { unwrapFormValue } from './util';\n\nexport class GenericRemediator extends Remediator {\n  canRemediate(): boolean {\n    // only handle remediations that are able to submit form (xhr)\n    if (typeof this.remediation.action !== 'function') {\n      return false;\n    }\n\n    // DO NOT REMOVE - bring it back when enable client side validation for GenericRemediator - OKTA-512003\n    // const inputs = this.getInputs();\n    // const res = inputs.reduce((acc, input) => {\n    //   return acc && hasValidInputValue(input, this.values);\n    // }, true);\n    // return res;\n\n    if (this.remediation.name === 'poll' || this.remediation.name.endsWith('-poll')) {\n      return true;\n    }\n\n    if (this.options.step) {\n      return true;\n    }\n    \n    // disable auto proceed for unknown remediations\n    return false;\n  }\n\n  getData() {\n    const data = this.getInputs().reduce((acc, { name }) => {\n      acc[name] = this.values[name];\n      return acc;\n    }, {});\n    return data;\n  }\n\n  getNextStep(authClient: OktaAuthIdxInterface, _context?: IdxContext): NextStep {\n    const name = this.getName();\n    const inputs = this.getInputs();\n    \n    /* eslint-disable no-unused-vars, @typescript-eslint/no-unused-vars */\n    // excludes transformed fields\n    const { \n      // http metas have been transformed to action\n      href, \n      method, \n      rel, \n      accepts, \n      produces, \n      // value has been transform to inputs\n      value,\n      // will be transformed to a function that resolves IdxTransaction\n      action,\n      ...rest \n    } = this.remediation;\n    /* eslint-enable no-unused-vars, @typescript-eslint/no-unused-vars */\n\n    // step to handle form submission\n    if (action) {\n      return { \n        ...rest,\n        ...(!!inputs.length && { inputs }),\n        action: async (params?) => {\n          return authClient.idx.proceed({\n            step: name,\n            ...params\n          });\n        }\n      };\n    }\n\n    // return whole remediation data for other steps, eg \"redirect-idp\"\n    return { ...this.remediation } as NextStep;\n    \n  }\n\n  getInputs(): Input[] {\n    return (this.remediation.value || [])\n      .filter(({ name }) => name !== 'stateHandle')\n      .map(unwrapFormValue)\n      .map(input => {\n        // use string as default input type\n        input.type = input.type || 'string';\n        return input;\n      });\n  }\n\n}\n"],"mappings":";;;AACA;AACA;AAEO,MAAMA,iBAAiB,SAASC,sBAAU,CAAC;EAChDC,YAAY,GAAY;IACtB;IACA,IAAI,OAAO,IAAI,CAACC,WAAW,CAACC,MAAM,KAAK,UAAU,EAAE;MACjD,OAAO,KAAK;IACd;;IAEA;IACA;IACA;IACA;IACA;IACA;;IAEA,IAAI,IAAI,CAACD,WAAW,CAACE,IAAI,KAAK,MAAM,IAAI,IAAI,CAACF,WAAW,CAACE,IAAI,CAACC,QAAQ,CAAC,OAAO,CAAC,EAAE;MAC/E,OAAO,IAAI;IACb;IAEA,IAAI,IAAI,CAACC,OAAO,CAACC,IAAI,EAAE;MACrB,OAAO,IAAI;IACb;;IAEA;IACA,OAAO,KAAK;EACd;EAEAC,OAAO,GAAG;IACR,MAAMC,IAAI,GAAG,IAAI,CAACC,SAAS,EAAE,CAACC,MAAM,CAAC,CAACC,GAAG,EAAE;MAAER;IAAK,CAAC,KAAK;MACtDQ,GAAG,CAACR,IAAI,CAAC,GAAG,IAAI,CAACS,MAAM,CAACT,IAAI,CAAC;MAC7B,OAAOQ,GAAG;IACZ,CAAC,EAAE,CAAC,CAAC,CAAC;IACN,OAAOH,IAAI;EACb;EAEAK,WAAW,CAACC,UAAgC,EAAEC,QAAqB,EAAY;IAC7E,MAAMZ,IAAI,GAAG,IAAI,CAACa,OAAO,EAAE;IAC3B,MAAMC,MAAM,GAAG,IAAI,CAACR,SAAS,EAAE;;IAE/B;IACA;IACA,MAAM;MACJ;MACAS,IAAI;MACJC,MAAM;MACNC,GAAG;MACHC,OAAO;MACPC,QAAQ;MACR;MACAC,KAAK;MACL;MACArB,MAAM;MACN,GAAGsB;IACL,CAAC,GAAG,IAAI,CAACvB,WAAW;IACpB;;IAEA;IACA,IAAIC,MAAM,EAAE;MACV,OAAO;QACL,GAAGsB,IAAI;QACP,IAAI,CAAC,CAACP,MAAM,CAACQ,MAAM,IAAI;UAAER;QAAO,CAAC,CAAC;QAClCf,MAAM,EAAE,MAAOwB,MAAO,IAAK;UACzB,OAAOZ,UAAU,CAACa,GAAG,CAACC,OAAO,CAAC;YAC5BtB,IAAI,EAAEH,IAAI;YACV,GAAGuB;UACL,CAAC,CAAC;QACJ;MACF,CAAC;IACH;;IAEA;IACA,OAAO;MAAE,GAAG,IAAI,CAACzB;IAAY,CAAC;EAEhC;EAEAQ,SAAS,GAAY;IACnB,OAAO,CAAC,IAAI,CAACR,WAAW,CAACsB,KAAK,IAAI,EAAE,EACjCM,MAAM,CAAC,CAAC;MAAE1B;IAAK,CAAC,KAAKA,IAAI,KAAK,aAAa,CAAC,CAC5C2B,GAAG,CAACC,qBAAe,CAAC,CACpBD,GAAG,CAACE,KAAK,IAAI;MACZ;MACAA,KAAK,CAACC,IAAI,GAAGD,KAAK,CAACC,IAAI,IAAI,QAAQ;MACnC,OAAOD,KAAK;IACd,CAAC,CAAC;EACN;AAEF;AAAC"}