{"version":3,"file":"storage.js","names":["createIdxStorageManager","CoreStorageManager","createCoreStorageManager","IdxStorageManager","constructor","storageManagerOptions","cookieOptions","storageUtil","getIdxResponseStorage","options","storage","isBrowser","getStorageByType","e","warn","transactionStorage","getTransactionStorage","getItem","key","transaction","getStorage","setItem","val","AuthSdkError","setStorage","removeItem","SavedObject","IDX_RESPONSE_STORAGE_NAME"],"sources":["../../../lib/idx/storage.ts"],"sourcesContent":["import { CookieOptions, StorageManagerOptions, StorageOptions, StorageUtil } from '../storage/types';\nimport {  IdxTransactionMeta } from './types';\nimport { SavedObject } from '../storage';\nimport { IDX_RESPONSE_STORAGE_NAME } from '../constants';\nimport { createCoreStorageManager } from '../core/storage';\nimport { IdxResponseStorage } from './types/storage';\nimport { isBrowser } from '../features';\nimport { warn } from '../util';\nimport AuthSdkError from '../errors/AuthSdkError';\n\nexport function createIdxStorageManager<M extends IdxTransactionMeta>()\n{\n  const CoreStorageManager = createCoreStorageManager<M>();\n  return class IdxStorageManager extends CoreStorageManager\n  {\n    constructor(storageManagerOptions: StorageManagerOptions, cookieOptions: CookieOptions, storageUtil: StorageUtil) {\n      super(storageManagerOptions, cookieOptions, storageUtil);\n    }\n\n    // intermediate idxResponse\n    // store for network traffic optimazation purpose\n    // TODO: revisit in auth-js 6.0 epic JIRA: OKTA-399791\n    getIdxResponseStorage(options?: StorageOptions): IdxResponseStorage | null {\n      let storage;\n      if (isBrowser()) {\n        // on browser side only use memory storage \n        try {\n          storage = this.storageUtil.getStorageByType('memory', options);\n        } catch (e) {\n          // it's ok to miss response storage\n          // eslint-disable-next-line max-len\n          warn('No response storage found, you may want to provide custom implementation for intermediate idx responses to optimize the network traffic');\n        }\n      } else {\n        // on server side re-use transaction custom storage\n        const transactionStorage = this.getTransactionStorage(options);\n        if (transactionStorage) {\n          storage = {\n            getItem: (key) => {\n              const transaction = transactionStorage.getStorage();\n              if (transaction && transaction[key]) {\n                return transaction[key];\n              }\n              return null;\n            },\n            setItem: (key, val) => {\n              const transaction = transactionStorage.getStorage();\n              if (!transaction) {\n                throw new AuthSdkError('Transaction has been cleared, failed to save idxState');\n              }\n              transaction[key] = val;\n              transactionStorage.setStorage(transaction);\n            },\n            removeItem: (key) => {\n              const transaction = transactionStorage.getStorage();\n              if (!transaction) {\n                return;\n              }\n              delete transaction[key];\n              transactionStorage.setStorage(transaction);\n            }\n          };\n        }\n      }\n\n      if (!storage) {\n        return null;\n      }\n\n      return new SavedObject(storage, IDX_RESPONSE_STORAGE_NAME);\n    }\n  };\n}\n"],"mappings":";;;;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEO,SAASA,uBAAuB,GACvC;EACE,MAAMC,kBAAkB,GAAG,IAAAC,kCAAwB,GAAK;EACxD,OAAO,MAAMC,iBAAiB,SAASF,kBAAkB,CACzD;IACEG,WAAW,CAACC,qBAA4C,EAAEC,aAA4B,EAAEC,WAAwB,EAAE;MAChH,KAAK,CAACF,qBAAqB,EAAEC,aAAa,EAAEC,WAAW,CAAC;IAC1D;;IAEA;IACA;IACA;IACAC,qBAAqB,CAACC,OAAwB,EAA6B;MACzE,IAAIC,OAAO;MACX,IAAI,IAAAC,mBAAS,GAAE,EAAE;QACf;QACA,IAAI;UACFD,OAAO,GAAG,IAAI,CAACH,WAAW,CAACK,gBAAgB,CAAC,QAAQ,EAAEH,OAAO,CAAC;QAChE,CAAC,CAAC,OAAOI,CAAC,EAAE;UACV;UACA;UACA,IAAAC,UAAI,EAAC,yIAAyI,CAAC;QACjJ;MACF,CAAC,MAAM;QACL;QACA,MAAMC,kBAAkB,GAAG,IAAI,CAACC,qBAAqB,CAACP,OAAO,CAAC;QAC9D,IAAIM,kBAAkB,EAAE;UACtBL,OAAO,GAAG;YACRO,OAAO,EAAGC,GAAG,IAAK;cAChB,MAAMC,WAAW,GAAGJ,kBAAkB,CAACK,UAAU,EAAE;cACnD,IAAID,WAAW,IAAIA,WAAW,CAACD,GAAG,CAAC,EAAE;gBACnC,OAAOC,WAAW,CAACD,GAAG,CAAC;cACzB;cACA,OAAO,IAAI;YACb,CAAC;YACDG,OAAO,EAAE,CAACH,GAAG,EAAEI,GAAG,KAAK;cACrB,MAAMH,WAAW,GAAGJ,kBAAkB,CAACK,UAAU,EAAE;cACnD,IAAI,CAACD,WAAW,EAAE;gBAChB,MAAM,IAAII,qBAAY,CAAC,uDAAuD,CAAC;cACjF;cACAJ,WAAW,CAACD,GAAG,CAAC,GAAGI,GAAG;cACtBP,kBAAkB,CAACS,UAAU,CAACL,WAAW,CAAC;YAC5C,CAAC;YACDM,UAAU,EAAGP,GAAG,IAAK;cACnB,MAAMC,WAAW,GAAGJ,kBAAkB,CAACK,UAAU,EAAE;cACnD,IAAI,CAACD,WAAW,EAAE;gBAChB;cACF;cACA,OAAOA,WAAW,CAACD,GAAG,CAAC;cACvBH,kBAAkB,CAACS,UAAU,CAACL,WAAW,CAAC;YAC5C;UACF,CAAC;QACH;MACF;MAEA,IAAI,CAACT,OAAO,EAAE;QACZ,OAAO,IAAI;MACb;MAEA,OAAO,IAAIgB,oBAAW,CAAChB,OAAO,EAAEiB,oCAAyB,CAAC;IAC5D;EACF,CAAC;AACH"}