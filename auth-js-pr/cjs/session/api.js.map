{"version":3,"file":"api.js","names":["sessionExists","sdk","session","get","then","res","status","catch","getSession","withCredentials","omit","refresh","post","getLink","href","user","closeSession","httpRequest","url","getIssuerOrigin","method","refreshSession","setCookieAndRedirect","sessionToken","redirectUrl","window","location","assign","toQueryString","checkAccountSetupComplete","token"],"sources":["../../../lib/session/api.ts"],"sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n *\n */\n/* global window */\nimport { omit, getLink, toQueryString } from '../util';\nimport { get, post, httpRequest } from '../http';\n\nfunction sessionExists(sdk) {\n  return sdk.session.get()\n    .then(function(res) {\n      if (res.status === 'ACTIVE') {\n        return true;\n      }\n      return false;\n    })\n    .catch(function() {\n      return false;\n    });\n}\n\nfunction getSession(sdk) { \n  return get(sdk, '/api/v1/sessions/me', { withCredentials: true })\n  .then(function(session) {\n    var res = omit(session, '_links');\n\n    res.refresh = function() {\n      return post(sdk, getLink(session, 'refresh').href, {}, { withCredentials: true });\n    };\n\n    res.user = function() {\n      return get(sdk, getLink(session, 'user').href, { withCredentials: true });\n    };\n\n    return res;\n  })\n  .catch(function() {\n    // Return INACTIVE status on failure\n    return {status: 'INACTIVE'};\n  });\n}\n\nfunction closeSession(sdk) {\n  return httpRequest(sdk, {\n    url: sdk.getIssuerOrigin() + '/api/v1/sessions/me',\n    method: 'DELETE',\n    withCredentials: true\n  });\n}\n\nfunction refreshSession(sdk) {\n  return post(sdk, '/api/v1/sessions/me/lifecycle/refresh', {}, { withCredentials: true });\n}\n\nfunction setCookieAndRedirect(sdk, sessionToken, redirectUrl) {\n  redirectUrl = redirectUrl || window.location.href;\n  window.location.assign(sdk.getIssuerOrigin() + '/login/sessionCookieRedirect' +\n    toQueryString({\n      checkAccountSetupComplete: true,\n      token: sessionToken,\n      redirectUrl: redirectUrl\n    }));\n}\n\nexport {\n  sessionExists,\n  getSession,\n  closeSession,\n  refreshSession,\n  setCookieAndRedirect\n};\n"],"mappings":";;;;;;;AAaA;AACA;AAdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAIA,SAASA,aAAa,CAACC,GAAG,EAAE;EAC1B,OAAOA,GAAG,CAACC,OAAO,CAACC,GAAG,EAAE,CACrBC,IAAI,CAAC,UAASC,GAAG,EAAE;IAClB,IAAIA,GAAG,CAACC,MAAM,KAAK,QAAQ,EAAE;MAC3B,OAAO,IAAI;IACb;IACA,OAAO,KAAK;EACd,CAAC,CAAC,CACDC,KAAK,CAAC,YAAW;IAChB,OAAO,KAAK;EACd,CAAC,CAAC;AACN;AAEA,SAASC,UAAU,CAACP,GAAG,EAAE;EACvB,OAAO,IAAAE,SAAG,EAACF,GAAG,EAAE,qBAAqB,EAAE;IAAEQ,eAAe,EAAE;EAAK,CAAC,CAAC,CAChEL,IAAI,CAAC,UAASF,OAAO,EAAE;IACtB,IAAIG,GAAG,GAAG,IAAAK,UAAI,EAACR,OAAO,EAAE,QAAQ,CAAC;IAEjCG,GAAG,CAACM,OAAO,GAAG,YAAW;MACvB,OAAO,IAAAC,UAAI,EAACX,GAAG,EAAE,IAAAY,aAAO,EAACX,OAAO,EAAE,SAAS,CAAC,CAACY,IAAI,EAAE,CAAC,CAAC,EAAE;QAAEL,eAAe,EAAE;MAAK,CAAC,CAAC;IACnF,CAAC;IAEDJ,GAAG,CAACU,IAAI,GAAG,YAAW;MACpB,OAAO,IAAAZ,SAAG,EAACF,GAAG,EAAE,IAAAY,aAAO,EAACX,OAAO,EAAE,MAAM,CAAC,CAACY,IAAI,EAAE;QAAEL,eAAe,EAAE;MAAK,CAAC,CAAC;IAC3E,CAAC;IAED,OAAOJ,GAAG;EACZ,CAAC,CAAC,CACDE,KAAK,CAAC,YAAW;IAChB;IACA,OAAO;MAACD,MAAM,EAAE;IAAU,CAAC;EAC7B,CAAC,CAAC;AACJ;AAEA,SAASU,YAAY,CAACf,GAAG,EAAE;EACzB,OAAO,IAAAgB,iBAAW,EAAChB,GAAG,EAAE;IACtBiB,GAAG,EAAEjB,GAAG,CAACkB,eAAe,EAAE,GAAG,qBAAqB;IAClDC,MAAM,EAAE,QAAQ;IAChBX,eAAe,EAAE;EACnB,CAAC,CAAC;AACJ;AAEA,SAASY,cAAc,CAACpB,GAAG,EAAE;EAC3B,OAAO,IAAAW,UAAI,EAACX,GAAG,EAAE,uCAAuC,EAAE,CAAC,CAAC,EAAE;IAAEQ,eAAe,EAAE;EAAK,CAAC,CAAC;AAC1F;AAEA,SAASa,oBAAoB,CAACrB,GAAG,EAAEsB,YAAY,EAAEC,WAAW,EAAE;EAC5DA,WAAW,GAAGA,WAAW,IAAIC,MAAM,CAACC,QAAQ,CAACZ,IAAI;EACjDW,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC1B,GAAG,CAACkB,eAAe,EAAE,GAAG,8BAA8B,GAC3E,IAAAS,mBAAa,EAAC;IACZC,yBAAyB,EAAE,IAAI;IAC/BC,KAAK,EAAEP,YAAY;IACnBC,WAAW,EAAEA;EACf,CAAC,CAAC,CAAC;AACP"}